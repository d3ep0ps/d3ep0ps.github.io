# Втрачене Мистецтво Системного Адміністрування

## Чому ми повинні опанувати "Старий Стек" (LAMP, Mail, DNS) перед тим, як торкатися Kubernetes.

У нашій попередній серії ми збудували фортецю.
Ми взяли "голий" сервер і посилили **Рівень Ідентичності** за допомогою SSH-ключів.
Ми захистили **Мережевий Рівень** за допомогою фаєрволів UFW та PF.
Ми автоматизували все це за допомогою Ansible та Terraform.

Тепер у нас є безпечний, закритий, автоматизований сервер.

**Але він порожній.**
Безпечний сервер, який нічого не робить, — марний.

Настав час відкривати крамницю.

До того, як я коли-небудь торкнувся Kubernetes, до того, як я написав Terraform або побудував multi-tenant SaaS архітектури, я провів більше десятиліття в окопах класичної інфраструктури.

Шість років у провайдера (ISP).
П'ять років будуючи shared хостинг, виділені сервери та глобальну VPS платформу.
Масштабування з чотирьох маленьких хмар до **сорока восьми локацій по всьому світу**.

Тоді "мікросервісів" не існувало.
Ядро всього нашого бізнесу працювало на **справжніх Unix сервісах**:

* **Apache**, що обслуговує мільйони PHP запитів.
* **MySQL** кластери, що живлять веб-додатки.
* **Postfix** черги, що тягнуться на кілометри.
* **Dovecot**, що тримає IMAP з'єднання живими.
* **Bind**, що запускає DNS для тисяч доменів.

Кожна аварія, кожен тікет, кожна надзвичайна ситуація — ви вирішували це, розуміючи, як сервіси насправді працюють на системі.

Не в контейнері. Не за оркестратором. А безпосередньо на **голому Linux та FreeBSD**.

### Втрачені Знання

Ось дивовижна правда:

> **Ці навички ніколи не переставали бути актуальними — вони просто сховалися під шарами абстракції.**

Сьогодні інженери розгортають контейнери, не розуміючи процесу всередині.
Вони покладаються на хмарний DNS, не знаючи, що таке Glue Record.
Вони запускають "поштові мікросервіси", не розуміючи черг SMTP.

І це проблема. Тому що:

* Якщо ви не розумієте Apache або Nginx, Kubernetes Ingress заплутає вас.
* Якщо ви не розумієте Postfix, Amazon SES залишиться чорною скринькою.
* Якщо ви не розумієте DNS, дебагінг *будь-якої* розподіленої системи стає ворожінням.

Отже, перш ніж ми подивимося на **chroot**, **jails** або **контейнери**, ми зробимо паузу.
Ми встановимо та налаштуємо **Стек Хостингу** — LAMP, FAMP, Mail та DNS — так, як це роблять справжні сисадміни.

Але спочатку нам потрібна ментальна модель.

## Ментальна Модель: Еволюція Ізоляції

Ніщо в технологіях не є справді новим. Кожен "сучасний" інструмент — це просто шар поверх старішої, простішої концепції. Щоб зрозуміти, куди ми йдемо, ми повинні зрозуміти п'ять фаз еволюції інфраструктури.

### Фаза 1: Голі Сервіси (Початок)
Це те, з чого починає кожен сисадмін. Ви встановлюєте сервіс безпосередньо на ОС хоста.
Apache біндиться на порт 80. MySQL біндиться на 3306.
Вони ділять одне й те саме ядро, ті самі бібліотеки і ту саму файлову систему.

**Урок:** Якщо ви не можете віддебажити сервіс, що працює нативно на хості, ви ніколи успішно не віддебажите його, коли він схований всередині контейнера.

### Фаза 2: Легковагова Ізоляція (Chroot & Jails)
Коли сервіси росли, нам потрібно було зупинити їхню боротьбу.
Unix представив **chroot** (зміну кореневої директорії), а пізніше **FreeBSD Jails** та **Solaris Zones**.

Це вирішило ранні проблеми мульти-тенантності:
* Один зламаний PHP сайт не повинен читати `/etc/passwd`.
* Один падаючий поштовий сервер не повинен викликати паніку ядра.

Це було ефективно, але це не було повністю розділено.

### Фаза 3: Віртуалізація (Революція VPS)
Це момент, коли моя кар'єра переключила передачі.
У 2000-х **Повна Віртуалізація** (KVM, Xen, VMware) змінила все.

Ми перестали нарізати *ОС*. Ми почали нарізати *Залізо*.

Це дозволило мені допомогти масштабувати хостинговий бізнес з кількох серверів до 48 глобальних локацій. Ми могли дати кожному клієнту їхнє власне ядро, їхній власний стек IP та їхнє власне блокове сховище.

**Урок:** Віртуалізація навчила нас про **гарантії ресурсів** та **мульти-тенантність**. Вона заклала фундамент для Хмари (AWS EC2 — це просто керована Віртуалізація).

### Фаза 4: Контейнери (Революція Пакування)
Docker не винайшов контейнери; він популяризував їх.
Він взяв ізоляцію Фази 2 і поєднав її з красивим форматом пакування.

Раптом ви могли запакувати Apache, PHP та ваш код в єдиний артефакт.
Але тут криється небезпека:
> **Контейнери дозволяють людям розгортати сервіси, які вони не розуміють.**

Коли контейнер ламається, якщо ви не знаєте Фазу 1 (Голі Сервіси), ви безпорадні.

### Фаза 5: Оркестрація (Рівень Управління)
Як тільки у вас є 1,000 контейнерів, вам потрібен робот, щоб керувати ними.
Зустрічайте **Kubernetes**.

Але всередині кожного Kubernetes Pod є просто контейнер.
А всередині кожного контейнера є просто **Сервіс** (Фаза 1).

Якщо ви пропустите основи, Kubernetes виглядає як магія. Якщо ви знаєте основи, Kubernetes — це просто складний інструмент, що керує простими процесами.

## Дорожня Карта: Побудова Стеку Хостингу

Ми збираємося побудувати "Мікро-Хостингову Компанію" на нашому захищеному сервері. Протягом наступних кількох статей ми розберемо сервіси, що живлять Інтернет, порівнюючи **Linux** та **FreeBSD** пліч-о-пліч.

### 1. Веб Стек (LAMP проти FAMP)
Ми налаштуємо Apache, MySQL та PHP.
* **Linux:** Шлях Debian/Ubuntu (`apt`, `systemd`, `/etc/apache2`).
* **FreeBSD:** Шлях Ports (`make install`, `rc.d`, `/usr/local/etc`).
Ми побачимо, чому розділення FreeBSD на "Базову ОС" та "Сторонні Додатки" робить її фаворитом для дисциплінованих інженерів.

### 2. Інфраструктурний Стек (DNS та Парадокс Bootstrap)
Ви не можете хостити домен, якщо у вас немає неймсервера.
Але ви не можете мати неймсервер (`ns1.yourdomain.com`), якщо домен ще не існує.
Ми вирішимо цей "Парадокс Bootstrap", встановивши **Bind** та налаштувавши **Glue Records**, ставши нашим власним Авторитетним DNS.

### 3. Комунікаційний Стек (Пошта — це Важко)
Хостинг пошти — це найважче завдання в системному адмініструванні.
Воно включає **Postfix** (SMTP), **Dovecot** (IMAP), **PostfixAdmin** (Управління) та **Roundcube** (Вебмейл).
Ми дізнаємося про SPF, DKIM та чому репутація IP важливіша за конфігурацію.

## Чому Це Все Ще Важливо

Ми робимо це не для того, щоб пережити минуле або відбудувати Інтернет зразка 2005 року.
Ми робимо це тому, що *основи ніколи не зникали* — вони просто стали схованими за API, дашбордами та шарами абстракції.

Кожна сучасна система все ще покладається на ті самі примітиви:

* Kubernetes Ingress — це просто HTTP проксіювання, загорнуте в YAML.
* Service Meshes — це фаєрволи, таблиці маршрутизації та автоматизація TLS у масштабі.
* Cloud DNS — це все ще Bind за API ендпоінтом.
* SES, SendGrid, Mailgun — це автоматизовані SMTP конвеєри.
* Кожен контейнер все ще запускає Unix процес.
* Кожна хмарна VM все ще завантажується як звичайний сервер.

Коли ви розумієте, **як насправді працює Старий Стек**, ніщо в сучасній інфраструктурі більше не здається магічним.
Ви припиняєте вгадувати.
Ви починаєте інженерити.

## Куди Ми Йдемо Далі

Ця стаття є прологом до нової, практичної послідовності: **Побудова Інтернету З Нуля — Шлях Інженера.**

Протягом наступних статей ми оживимо наш захищений сервер, встановивши та налаштувавши реальні сервіси, які все ще живлять сучасний Інтернет:

### 1. Веб Стек — LAMP проти FAMP
Apache + MySQL + PHP на Linux та FreeBSD. Пліч-о-пліч. З усіма відмінностями, що мають значення.

### 2. Стек Імен — Запуск Вашого Власного DNS
Ми встановимо **Bind**, налаштуємо авторитетні зони, SOA, A/AAAA, NS, MX записи, і вирішимо *Glue Record Bootstrap Paradox*, який використовує кожен хостинг-провайдер.

### 3. Стек Пошти — Postfix + Dovecot
Повна, працююча поштова система з SMTP, IMAP, PostfixAdmin та Roundcube — включаючи SPF, DKIM та DMARC.

### 4. Підготовка до Ізоляції
Як тільки все запрацює на "голому залізі", ми перемістимося на один шар глибше: **chroot, FreeBSD Jails, Контейнери та Kubernetes.**

Тому що як тільки ви знаєте, як сервіс працює **на хості**, кожна абстракція над ним стає очевидною.

## Справжня Причина, Чому Ми Це Робимо

До Docker, до Kubernetes, до IaC, до хмарної автоматизації — **все, що у нас було, це сервіси, що працюють на справжніх Unix системах.**

Ті системи навчили надійності.
Вони навчили дисципліни.
Вони навчили дебагінгу без дашбордів.
Вони навчили інженерії.

І ці уроки переносяться вперед.

Тому що незалежно від того, чи працює ваш код у контейнері, чи у FreeBSD jail, чи у VM в Сінгапурі, він все ще обслуговується HTTP сервером, базою даних, поштовою чергою та DNS резолвером.

Ця серія про вивчення того, *чому* ці речі працюють, а не просто як їх розгорнути.

**Далі: Побудова Вебу — LAMP проти FAMP.**

Наш сервер захищений. Стіни зведені. Тепер час відкривати крамницю.
